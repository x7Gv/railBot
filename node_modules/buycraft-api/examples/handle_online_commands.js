var BuyCraft = require('../index.js');

// This is my test shop token. It is no longer valid yet.
var api = new BuyCraft('53732202989ef3afd7038f0ac0d88b7539365d05');

api.queue.getPendingPlayers(function(err, data) {

    if (err) {throw err;}

    // This is not the best way to iterate with functions inside.
    // Please, use the async forEachOf function if you have to
    for (var i = 0; i < data.players.length; i++) {

        var player = data.players[i];

        api.queue.getOnlineCommands(player.id, function(err, data) {

            console.log("Handling player: " + player.name + "(" + player.uuid + ")");

            if (!err) {

                var drop_list = [];

                for (var x = 0; x < data.commands.length; x++) {

                    console.log(data.commands[x]);
                    drop_list.push(data.commands[x]['id']);

                }

                if (drop_list.length == 0) {return console.log("No commands found!");}
                console.log("Dropping commands for player: " + player.name);

                // You can drop a single command or a list of command ids.
                api.queue.deleteCommands(drop_list, function(err) {

                    if (err) {

                        console.log("Failed to delete commands!")

                    }

                });

            } else console.log("Error: " + err.message);

        });

    }

});
